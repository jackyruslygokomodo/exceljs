{"version":3,"file":"conditional-formattings-xform.js","names":["BaseXform","require","ConditionalFormattingXform","ConditionalFormattingsXform","cfXform","model","options","nextPriority","reduce","p","cf","Math","max","rules","map","rule","priority","forEach","style","dxfId","styles","addDxfStyle","xmlStream","render","node","parser","parseOpen","name","text","parseText","parseClose","push","undefined","getDxfStyle","module","exports"],"sources":["../../../../../../lib/xlsx/xform/sheet/cf/conditional-formattings-xform.js"],"sourcesContent":["const BaseXform = require('../../base-xform');\n\nconst ConditionalFormattingXform = require('./conditional-formatting-xform');\n\nclass ConditionalFormattingsXform extends BaseXform {\n  constructor() {\n    super();\n\n    this.cfXform = new ConditionalFormattingXform();\n  }\n\n  get tag() {\n    return 'conditionalFormatting';\n  }\n\n  reset() {\n    this.model = [];\n  }\n\n  prepare(model, options) {\n    // ensure each rule has a priority value\n    let nextPriority = model.reduce(\n      (p, cf) => Math.max(p, ...cf.rules.map(rule => rule.priority || 0)),\n      1\n    );\n    model.forEach(cf => {\n      cf.rules.forEach(rule => {\n        if (!rule.priority) {\n          rule.priority = nextPriority++;\n        }\n\n        if (rule.style) {\n          rule.dxfId = options.styles.addDxfStyle(rule.style);\n        }\n      });\n    });\n  }\n\n  render(xmlStream, model) {\n    model.forEach(cf => {\n      this.cfXform.render(xmlStream, cf);\n    });\n  }\n\n  parseOpen(node) {\n    if (this.parser) {\n      this.parser.parseOpen(node);\n      return true;\n    }\n\n    switch (node.name) {\n      case 'conditionalFormatting':\n        this.parser = this.cfXform;\n        this.parser.parseOpen(node);\n        return true;\n\n      default:\n        return false;\n    }\n  }\n\n  parseText(text) {\n    if (this.parser) {\n      this.parser.parseText(text);\n    }\n  }\n\n  parseClose(name) {\n    if (this.parser) {\n      if (!this.parser.parseClose(name)) {\n        this.model.push(this.parser.model);\n        this.parser = undefined;\n        return false;\n      }\n      return true;\n    }\n    return false;\n  }\n\n  reconcile(model, options) {\n    model.forEach(cf => {\n      cf.rules.forEach(rule => {\n        if (rule.dxfId !== undefined) {\n          rule.style = options.styles.getDxfStyle(rule.dxfId);\n          delete rule.dxfId;\n        }\n      });\n    });\n  }\n}\n\nmodule.exports = ConditionalFormattingsXform;\n"],"mappings":"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"}