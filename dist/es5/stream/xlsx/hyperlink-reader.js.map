{"version":3,"file":"hyperlink-reader.js","names":["require","EventEmitter","parseSax","Enums","RelType","HyperlinkReader","workbook","id","iterator","options","hyperlinks","length","fn","forEach","emitHyperlinks","emit","events","eventType","value","node","name","rId","attributes","Id","Type","Hyperlink","relationship","type","RelationshipType","Styles","target","Target","targetMode","TargetMode","module","exports"],"sources":["../../../../lib/stream/xlsx/hyperlink-reader.js"],"sourcesContent":["const {EventEmitter} = require('events');\nconst parseSax = require('../../utils/parse-sax');\n\nconst Enums = require('../../doc/enums');\nconst RelType = require('../../xlsx/rel-type');\n\nclass HyperlinkReader extends EventEmitter {\n  constructor({workbook, id, iterator, options}) {\n    super();\n\n    this.workbook = workbook;\n    this.id = id;\n    this.iterator = iterator;\n    this.options = options;\n  }\n\n  get count() {\n    return (this.hyperlinks && this.hyperlinks.length) || 0;\n  }\n\n  each(fn) {\n    return this.hyperlinks.forEach(fn);\n  }\n\n  async read() {\n    const {iterator, options} = this;\n    let emitHyperlinks = false;\n    let hyperlinks = null;\n    switch (options.hyperlinks) {\n      case 'emit':\n        emitHyperlinks = true;\n        break;\n      case 'cache':\n        this.hyperlinks = hyperlinks = {};\n        break;\n      default:\n        break;\n    }\n\n    if (!emitHyperlinks && !hyperlinks) {\n      this.emit('finished');\n      return;\n    }\n\n    try {\n      for await (const events of parseSax(iterator)) {\n        for (const {eventType, value} of events) {\n          if (eventType === 'opentag') {\n            const node = value;\n            if (node.name === 'Relationship') {\n              const rId = node.attributes.Id;\n              switch (node.attributes.Type) {\n                case RelType.Hyperlink:\n                  {\n                    const relationship = {\n                      type: Enums.RelationshipType.Styles,\n                      rId,\n                      target: node.attributes.Target,\n                      targetMode: node.attributes.TargetMode,\n                    };\n                    if (emitHyperlinks) {\n                      this.emit('hyperlink', relationship);\n                    } else {\n                      hyperlinks[relationship.rId] = relationship;\n                    }\n                  }\n                  break;\n\n                default:\n                  break;\n              }\n            }\n          }\n        }\n      }\n      this.emit('finished');\n    } catch (error) {\n      this.emit('error', error);\n    }\n  }\n}\n\nmodule.exports = HyperlinkReader;\n"],"mappings":";;;+CACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AADA,eAAuBA,OAAO,CAAC,QAAQ,CAAC;EAAjCC,YAAY,YAAZA,YAAY;AACnB,IAAMC,QAAQ,GAAGF,OAAO,CAAC,uBAAuB,CAAC;AAEjD,IAAMG,KAAK,GAAGH,OAAO,CAAC,iBAAiB,CAAC;AACxC,IAAMI,OAAO,GAAGJ,OAAO,CAAC,qBAAqB,CAAC;AAAC,IAEzCK,eAAe;EAAA;EAAA;EACnB,+BAA+C;IAAA;IAAA,IAAlCC,QAAQ,QAARA,QAAQ;MAAEC,EAAE,QAAFA,EAAE;MAAEC,QAAQ,QAARA,QAAQ;MAAEC,OAAO,QAAPA,OAAO;IAAA;IAC1C;IAEA,MAAKH,QAAQ,GAAGA,QAAQ;IACxB,MAAKC,EAAE,GAAGA,EAAE;IACZ,MAAKC,QAAQ,GAAGA,QAAQ;IACxB,MAAKC,OAAO,GAAGA,OAAO;IAAC;EACzB;EAAC;IAAA;IAAA,KAED,eAAY;MACV,OAAQ,IAAI,CAACC,UAAU,IAAI,IAAI,CAACA,UAAU,CAACC,MAAM,IAAK,CAAC;IACzD;EAAC;IAAA;IAAA,OAED,cAAKC,EAAE,EAAE;MACP,OAAO,IAAI,CAACF,UAAU,CAACG,OAAO,CAACD,EAAE,CAAC;IACpC;EAAC;IAAA;IAAA;MAAA,uEAED;QAAA;QAAA;UAAA;YAAA;cACSJ,QAAQ,GAAa,IAAI,CAAzBA,QAAQ,EAAEC,OAAO,GAAI,IAAI,CAAfA,OAAO;cACpBK,cAAc,GAAG,KAAK;cACtBJ,UAAU,GAAG,IAAI;cAAA,cACbD,OAAO,CAACC,UAAU;cAAA,gCACnB,MAAM,uBAGN,OAAO;cAAA;YAAA;cAFVI,cAAc,GAAG,IAAI;cAAC;YAAA;cAGtB,IAAI,CAACJ,UAAU,GAAGA,UAAU,GAAG,CAAC,CAAC;cAAC;YAAA;cAAA;YAAA;cAAA,MAMlC,CAACI,cAAc,IAAI,CAACJ,UAAU;gBAAA;gBAAA;cAAA;cAChC,IAAI,CAACK,IAAI,CAAC,UAAU,CAAC;cAAC;YAAA;cAAA;cAAA;cAAA;cAAA;cAAA,2BAKKb,QAAQ,CAACM,QAAQ,CAAC;YAAA;cAAA;cAAA;YAAA;cAAA;gBAAA;gBAAA;cAAA;cAA5BQ,MAAM;cAAA,wCACYA,MAAM;cAAA;cAAA;YAAA;cAAA;gBAAA;gBAAA;cAAA;cAAA,6BAA3BC,SAAS,gBAATA,SAAS,EAAEC,KAAK,gBAALA,KAAK;cAAA,MACtBD,SAAS,KAAK,SAAS;gBAAA;gBAAA;cAAA;cACnBE,IAAI,GAAGD,KAAK;cAAA,MACdC,IAAI,CAACC,IAAI,KAAK,cAAc;gBAAA;gBAAA;cAAA;cACxBC,GAAG,GAAGF,IAAI,CAACG,UAAU,CAACC,EAAE;cAAA,cACtBJ,IAAI,CAACG,UAAU,CAACE,IAAI;cAAA,gCACrBpB,OAAO,CAACqB,SAAS;cAAA;YAAA;cAEZC,YAAY,GAAG;gBACnBC,IAAI,EAAExB,KAAK,CAACyB,gBAAgB,CAACC,MAAM;gBACnCR,GAAG,EAAHA,GAAG;gBACHS,MAAM,EAAEX,IAAI,CAACG,UAAU,CAACS,MAAM;gBAC9BC,UAAU,EAAEb,IAAI,CAACG,UAAU,CAACW;cAC9B,CAAC;cACD,IAAInB,cAAc,EAAE;gBAClB,IAAI,CAACC,IAAI,CAAC,WAAW,EAAEW,YAAY,CAAC;cACtC,CAAC,MAAM;gBACLhB,UAAU,CAACgB,YAAY,CAACL,GAAG,CAAC,GAAGK,YAAY;cAC7C;cAAC;YAAA;cAAA;YAAA;cAAA;cAAA;YAAA;cAAA;cAAA;YAAA;cAAA;cAAA;cAAA;YAAA;cAAA;cAAA;cAAA;YAAA;cAAA;cAAA;cAAA;YAAA;cAAA;cAAA;YAAA;cAAA;cAAA;cAAA;cAAA;YAAA;cAAA;cAAA;cAAA;gBAAA;gBAAA;cAAA;cAAA;cAAA;YAAA;cAAA;cAAA;gBAAA;gBAAA;cAAA;cAAA;YAAA;cAAA;YAAA;cAAA;YAAA;cAWf,IAAI,CAACX,IAAI,CAAC,UAAU,CAAC;cAAC;cAAA;YAAA;cAAA;cAAA;cAEtB,IAAI,CAACA,IAAI,CAAC,OAAO,cAAQ;YAAC;YAAA;cAAA;UAAA;QAAA;MAAA,CAE7B;MAAA;QAAA;MAAA;MAAA;IAAA;EAAA;EAAA;AAAA,EAzE2Bd,YAAY;AA4E1CiC,MAAM,CAACC,OAAO,GAAG9B,eAAe"}