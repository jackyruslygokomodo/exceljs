{"version":3,"file":"workbook.js","names":["Worksheet","require","DefinedNames","XLSX","CSV","Workbook","category","company","created","Date","description","keywords","manager","modified","properties","calcProperties","_worksheets","subject","title","views","media","_definedNames","_xlsx","_csv","i","length","name","options","id","nextId","console","warn","test","Error","substring","find","ws","toLowerCase","trace","tabColor","argb","theme","indexed","lastOrderNo","reduce","acc","orderNo","worksheetOptions","Object","assign","workbook","worksheet","getWorksheet","destroy","undefined","Boolean","slice","sort","a","b","filter","iteratee","worksheets","forEach","sheet","_themes","image","push","type","creator","lastModifiedBy","lastPrinted","map","model","sheets","definedNames","language","revision","contentStatus","themes","value","worksheetModel","state","findIndex","module","exports"],"sources":["../../../lib/doc/workbook.js"],"sourcesContent":["'use strict';\n\nconst Worksheet = require('./worksheet');\nconst DefinedNames = require('./defined-names');\nconst XLSX = require('../xlsx/xlsx');\nconst CSV = require('../csv/csv');\n\n// Workbook requirements\n//  Load and Save from file and stream\n//  Access/Add/Delete individual worksheets\n//  Manage String table, Hyperlink table, etc.\n//  Manage scaffolding for contained objects to write to/read from\n\nclass Workbook {\n  constructor() {\n    this.category = '';\n    this.company = '';\n    this.created = new Date();\n    this.description = '';\n    this.keywords = '';\n    this.manager = '';\n    this.modified = this.created;\n    this.properties = {};\n    this.calcProperties = {};\n    this._worksheets = [];\n    this.subject = '';\n    this.title = '';\n    this.views = [];\n    this.media = [];\n    this._definedNames = new DefinedNames();\n  }\n\n  get xlsx() {\n    if (!this._xlsx) this._xlsx = new XLSX(this);\n    return this._xlsx;\n  }\n\n  get csv() {\n    if (!this._csv) this._csv = new CSV(this);\n    return this._csv;\n  }\n\n  get nextId() {\n    // find the next unique spot to add worksheet\n    for (let i = 1; i < this._worksheets.length; i++) {\n      if (!this._worksheets[i]) {\n        return i;\n      }\n    }\n    return this._worksheets.length || 1;\n  }\n\n  addWorksheet(name, options) {\n    const id = this.nextId;\n\n    if (name && name.length > 31) {\n      // eslint-disable-next-line no-console\n      console.warn(`Worksheet name ${name} exceeds 31 chars. This will be truncated`);\n    }\n\n    // Illegal character in worksheet name: asterisk (*), question mark (?),\n    // colon (:), forward slash (/ \\), or bracket ([])\n    if (/[*?:/\\\\[\\]]/.test(name)) {\n      throw new Error(\n        `Worksheet name ${name} cannot include any of the following characters: * ? : \\\\ / [ ]`\n      );\n    }\n\n    if (/(^')|('$)/.test(name)) {\n      throw new Error(\n        `The first or last character of worksheet name cannot be a single quotation mark: ${name}`\n      );\n    }\n\n    name = (name || `sheet${id}`).substring(0, 31);\n    if (this._worksheets.find(ws => ws && ws.name.toLowerCase() === name.toLowerCase())) {\n      throw new Error(`Worksheet name already exists: ${name}`);\n    }\n\n    // if options is a color, call it tabColor (and signal deprecated message)\n    if (options) {\n      if (typeof options === 'string') {\n        // eslint-disable-next-line no-console\n        console.trace(\n          'tabColor argument is now deprecated. Please use workbook.addWorksheet(name, {properties: { tabColor: { argb: \"rbg value\" } }'\n        );\n        options = {\n          properties: {\n            tabColor: {argb: options},\n          },\n        };\n      } else if (options.argb || options.theme || options.indexed) {\n        // eslint-disable-next-line no-console\n        console.trace(\n          'tabColor argument is now deprecated. Please use workbook.addWorksheet(name, {properties: { tabColor: { ... } }'\n        );\n        options = {\n          properties: {\n            tabColor: options,\n          },\n        };\n      }\n    }\n\n    const lastOrderNo = this._worksheets.reduce(\n      (acc, ws) => ((ws && ws.orderNo) > acc ? ws.orderNo : acc),\n      0\n    );\n    const worksheetOptions = Object.assign({}, options, {\n      id,\n      name,\n      orderNo: lastOrderNo + 1,\n      workbook: this,\n    });\n\n    const worksheet = new Worksheet(worksheetOptions);\n\n    this._worksheets[id] = worksheet;\n    return worksheet;\n  }\n\n  removeWorksheetEx(worksheet) {\n    delete this._worksheets[worksheet.id];\n  }\n\n  removeWorksheet(id) {\n    const worksheet = this.getWorksheet(id);\n    if (worksheet) {\n      worksheet.destroy();\n    }\n  }\n\n  getWorksheet(id) {\n    if (id === undefined) {\n      return this._worksheets.find(Boolean);\n    }\n    if (typeof id === 'number') {\n      return this._worksheets[id];\n    }\n    if (typeof id === 'string') {\n      return this._worksheets.find(worksheet => worksheet && worksheet.name === id);\n    }\n    return undefined;\n  }\n\n  get worksheets() {\n    // return a clone of _worksheets\n    return this._worksheets\n      .slice(1)\n      .sort((a, b) => a.orderNo - b.orderNo)\n      .filter(Boolean);\n  }\n\n  eachSheet(iteratee) {\n    this.worksheets.forEach(sheet => {\n      iteratee(sheet, sheet.id);\n    });\n  }\n\n  get definedNames() {\n    return this._definedNames;\n  }\n\n  clearThemes() {\n    // Note: themes are not an exposed feature, meddle at your peril!\n    this._themes = undefined;\n  }\n\n  addImage(image) {\n    // TODO:  validation?\n    const id = this.media.length;\n    this.media.push(Object.assign({}, image, {type: 'image'}));\n    return id;\n  }\n\n  getImage(id) {\n    return this.media[id];\n  }\n\n  get model() {\n    return {\n      creator: this.creator || 'Unknown',\n      lastModifiedBy: this.lastModifiedBy || 'Unknown',\n      lastPrinted: this.lastPrinted,\n      created: this.created,\n      modified: this.modified,\n      properties: this.properties,\n      worksheets: this.worksheets.map(worksheet => worksheet.model),\n      sheets: this.worksheets.map(ws => ws.model).filter(Boolean),\n      definedNames: this._definedNames.model,\n      views: this.views,\n      company: this.company,\n      manager: this.manager,\n      title: this.title,\n      subject: this.subject,\n      keywords: this.keywords,\n      category: this.category,\n      description: this.description,\n      language: this.language,\n      revision: this.revision,\n      contentStatus: this.contentStatus,\n      themes: this._themes,\n      media: this.media,\n      calcProperties: this.calcProperties,\n    };\n  }\n\n  set model(value) {\n    this.creator = value.creator;\n    this.lastModifiedBy = value.lastModifiedBy;\n    this.lastPrinted = value.lastPrinted;\n    this.created = value.created;\n    this.modified = value.modified;\n    this.company = value.company;\n    this.manager = value.manager;\n    this.title = value.title;\n    this.subject = value.subject;\n    this.keywords = value.keywords;\n    this.category = value.category;\n    this.description = value.description;\n    this.language = value.language;\n    this.revision = value.revision;\n    this.contentStatus = value.contentStatus;\n\n    this.properties = value.properties;\n    this.calcProperties = value.calcProperties;\n    this._worksheets = [];\n    value.worksheets.forEach(worksheetModel => {\n      const {id, name, state} = worksheetModel;\n      const orderNo = value.sheets && value.sheets.findIndex(ws => ws.id === id);\n      const worksheet = (this._worksheets[id] = new Worksheet({\n        id,\n        name,\n        orderNo,\n        state,\n        workbook: this,\n      }));\n\n      worksheet.model = worksheetModel;\n    });\n\n    this._definedNames.model = value.definedNames;\n    this.views = value.views;\n    this._themes = value.themes;\n    this.media = value.media || [];\n  }\n}\n\nmodule.exports = Workbook;\n"],"mappings":"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"}