{"version":3,"file":"cell-matrix.js","names":["_","require","colCache","CellMatrix","template","sheets","addressStr","addCellEx","decodeEx","findCellEx","sheetName","rowNumber","colNumber","sheet","row","address","top","bottom","col","left","right","getCellAt","create","findSheet","findSheetRow","findRowCell","cell","n2l","callback","forEach","each","forEachInSheet","results","push","name","undefined","Object","assign","JSON","parse","stringify","start","numDelete","numInsert","inserts","i","splice","module","exports"],"sources":["../../../lib/utils/cell-matrix.js"],"sourcesContent":["const _ = require('./under-dash');\nconst colCache = require('./col-cache');\n\nclass CellMatrix {\n  constructor(template) {\n    this.template = template;\n    this.sheets = {};\n  }\n\n  addCell(addressStr) {\n    this.addCellEx(colCache.decodeEx(addressStr));\n  }\n\n  getCell(addressStr) {\n    return this.findCellEx(colCache.decodeEx(addressStr), true);\n  }\n\n  findCell(addressStr) {\n    return this.findCellEx(colCache.decodeEx(addressStr), false);\n  }\n\n  findCellAt(sheetName, rowNumber, colNumber) {\n    const sheet = this.sheets[sheetName];\n    const row = sheet && sheet[rowNumber];\n    return row && row[colNumber];\n  }\n\n  addCellEx(address) {\n    if (address.top) {\n      for (let row = address.top; row <= address.bottom; row++) {\n        for (let col = address.left; col <= address.right; col++) {\n          this.getCellAt(address.sheetName, row, col);\n        }\n      }\n    } else {\n      this.findCellEx(address, true);\n    }\n  }\n\n  getCellEx(address) {\n    return this.findCellEx(address, true);\n  }\n\n  findCellEx(address, create) {\n    const sheet = this.findSheet(address, create);\n    const row = this.findSheetRow(sheet, address, create);\n    return this.findRowCell(row, address, create);\n  }\n\n  getCellAt(sheetName, rowNumber, colNumber) {\n    const sheet = this.sheets[sheetName] || (this.sheets[sheetName] = []);\n    const row = sheet[rowNumber] || (sheet[rowNumber] = []);\n    const cell =\n      row[colNumber] ||\n      (row[colNumber] = {\n        sheetName,\n        address: colCache.n2l(colNumber) + rowNumber,\n        row: rowNumber,\n        col: colNumber,\n      });\n    return cell;\n  }\n\n  removeCellEx(address) {\n    const sheet = this.findSheet(address);\n    if (!sheet) {\n      return;\n    }\n    const row = this.findSheetRow(sheet, address);\n    if (!row) {\n      return;\n    }\n    delete row[address.col];\n  }\n\n  forEachInSheet(sheetName, callback) {\n    const sheet = this.sheets[sheetName];\n    if (sheet) {\n      sheet.forEach((row, rowNumber) => {\n        if (row) {\n          row.forEach((cell, colNumber) => {\n            if (cell) {\n              callback(cell, rowNumber, colNumber);\n            }\n          });\n        }\n      });\n    }\n  }\n\n  forEach(callback) {\n    _.each(this.sheets, (sheet, sheetName) => {\n      this.forEachInSheet(sheetName, callback);\n    });\n  }\n\n  map(callback) {\n    const results = [];\n    this.forEach(cell => {\n      results.push(callback(cell));\n    });\n    return results;\n  }\n\n  findSheet(address, create) {\n    const name = address.sheetName;\n    if (this.sheets[name]) {\n      return this.sheets[name];\n    }\n    if (create) {\n      return (this.sheets[name] = []);\n    }\n    return undefined;\n  }\n\n  findSheetRow(sheet, address, create) {\n    const {row} = address;\n    if (sheet && sheet[row]) {\n      return sheet[row];\n    }\n    if (create) {\n      return (sheet[row] = []);\n    }\n    return undefined;\n  }\n\n  findRowCell(row, address, create) {\n    const {col} = address;\n    if (row && row[col]) {\n      return row[col];\n    }\n    if (create) {\n      return (row[col] = this.template\n        ? Object.assign(address, JSON.parse(JSON.stringify(this.template)))\n        : address);\n    }\n    return undefined;\n  }\n\n  spliceRows(sheetName, start, numDelete, numInsert) {\n    const sheet = this.sheets[sheetName];\n    if (sheet) {\n      const inserts = [];\n      for (let i = 0; i < numInsert; i++) {\n        inserts.push([]);\n      }\n      sheet.splice(start, numDelete, ...inserts);\n    }\n  }\n\n  spliceColumns(sheetName, start, numDelete, numInsert) {\n    const sheet = this.sheets[sheetName];\n    if (sheet) {\n      const inserts = [];\n      for (let i = 0; i < numInsert; i++) {\n        inserts.push(null);\n      }\n      _.each(sheet, row => {\n        row.splice(start, numDelete, ...inserts);\n      });\n    }\n  }\n}\n\nmodule.exports = CellMatrix;\n"],"mappings":"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"}