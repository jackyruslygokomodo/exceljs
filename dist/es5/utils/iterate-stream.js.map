{"version":3,"file":"iterate-stream.js","names":["module","exports","stream","contents","on","data","push","streamEndedPromise","Promise","resolve","resolveStreamEndedPromise","ended","error","err","length","resume","race","once","pause","shift","iterateStream","eventEmitter","type","fired","handler","removeListener","addListener"],"sources":["../../../lib/utils/iterate-stream.js"],"sourcesContent":["module.exports = async function* iterateStream(stream) {\n  const contents = [];\n  stream.on('data', data => contents.push(data));\n\n  let resolveStreamEndedPromise;\n  const streamEndedPromise = new Promise(resolve => (resolveStreamEndedPromise = resolve));\n\n  let ended = false;\n  stream.on('end', () => {\n    ended = true;\n    resolveStreamEndedPromise();\n  });\n\n  let error = false;\n  stream.on('error', err => {\n    error = err;\n    resolveStreamEndedPromise();\n  });\n\n  while (!ended || contents.length > 0) {\n    if (contents.length === 0) {\n      stream.resume();\n      // eslint-disable-next-line no-await-in-loop\n      await Promise.race([once(stream, 'data'), streamEndedPromise]);\n    } else {\n      stream.pause();\n      const data = contents.shift();\n      yield data;\n    }\n    if (error) throw error;\n  }\n  resolveStreamEndedPromise();\n};\n\nfunction once(eventEmitter, type) {\n  // TODO: Use require('events').once when node v10 is dropped\n  return new Promise(resolve => {\n    let fired = false;\n    const handler = () => {\n      if (!fired) {\n        fired = true;\n        eventEmitter.removeListener(type, handler);\n        resolve();\n      }\n    };\n    eventEmitter.addListener(type, handler);\n  });\n}\n"],"mappings":";;;+CACA;AAAA;AAAA;AAAA;AAAA;AAAA;AADAA,MAAM,CAACC,OAAO;EAAA,kFAAG,iBAA8BC,MAAM;IAAA;IAAA;MAAA;QAAA;UAC7CC,QAAQ,GAAG,EAAE;UACnBD,MAAM,CAACE,EAAE,CAAC,MAAM,EAAE,UAAAC,IAAI;YAAA,OAAIF,QAAQ,CAACG,IAAI,CAACD,IAAI,CAAC;UAAA,EAAC;UAGxCE,kBAAkB,GAAG,IAAIC,OAAO,CAAC,UAAAC,OAAO;YAAA,OAAKC,yBAAyB,GAAGD,OAAO;UAAA,CAAC,CAAC;UAEpFE,KAAK,GAAG,KAAK;UACjBT,MAAM,CAACE,EAAE,CAAC,KAAK,EAAE,YAAM;YACrBO,KAAK,GAAG,IAAI;YACZD,yBAAyB,EAAE;UAC7B,CAAC,CAAC;UAEEE,KAAK,GAAG,KAAK;UACjBV,MAAM,CAACE,EAAE,CAAC,OAAO,EAAE,UAAAS,GAAG,EAAI;YACxBD,KAAK,GAAGC,GAAG;YACXH,yBAAyB,EAAE;UAC7B,CAAC,CAAC;QAAC;UAAA,MAEI,CAACC,KAAK,IAAIR,QAAQ,CAACW,MAAM,GAAG,CAAC;YAAA;YAAA;UAAA;UAAA,MAC9BX,QAAQ,CAACW,MAAM,KAAK,CAAC;YAAA;YAAA;UAAA;UACvBZ,MAAM,CAACa,MAAM,EAAE;UACf;UAAA;UAAA,4BACMP,OAAO,CAACQ,IAAI,CAAC,CAACC,IAAI,CAACf,MAAM,EAAE,MAAM,CAAC,EAAEK,kBAAkB,CAAC,CAAC;QAAA;UAAA;UAAA;QAAA;UAE9DL,MAAM,CAACgB,KAAK,EAAE;UACRb,IAAI,GAAGF,QAAQ,CAACgB,KAAK,EAAE;UAAA;UAC7B,OAAMd,IAAI;QAAA;UAAA,KAERO,KAAK;YAAA;YAAA;UAAA;UAAA,MAAQA,KAAK;QAAA;UAAA;UAAA;QAAA;UAExBF,yBAAyB,EAAE;QAAC;QAAA;UAAA;MAAA;IAAA;EAAA,CAC7B;EAAA,SAhCgCU,aAAa;IAAA;EAAA;EAAA,OAAbA,aAAa;AAAA,GAgC7C;AAED,SAASH,IAAI,CAACI,YAAY,EAAEC,IAAI,EAAE;EAChC;EACA,OAAO,IAAId,OAAO,CAAC,UAAAC,OAAO,EAAI;IAC5B,IAAIc,KAAK,GAAG,KAAK;IACjB,IAAMC,OAAO,GAAG,SAAVA,OAAO,GAAS;MACpB,IAAI,CAACD,KAAK,EAAE;QACVA,KAAK,GAAG,IAAI;QACZF,YAAY,CAACI,cAAc,CAACH,IAAI,EAAEE,OAAO,CAAC;QAC1Cf,OAAO,EAAE;MACX;IACF,CAAC;IACDY,YAAY,CAACK,WAAW,CAACJ,IAAI,EAAEE,OAAO,CAAC;EACzC,CAAC,CAAC;AACJ"}