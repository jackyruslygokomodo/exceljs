{"version":3,"file":"sheet-view-xform.js","names":["colCache","require","BaseXform","VIEW_STATES","frozen","frozenSplit","split","SheetViewXform","model","state","xmlStream","openNode","workbookViewId","add","name","value","included","addAttribute","rightToLeft","tabSelected","showRuler","showRowColHeaders","showGridLines","zoomScale","zoomScaleNormal","style","topLeftCell","xSplit","ySplit","activePane","getAddress","address","leafNode","undefined","pane","activeCell","sqref","closeNode","node","sheetView","parseInt","attributes","view","selections","selection","topLeft","module","exports"],"sources":["../../../../../lib/xlsx/xform/sheet/sheet-view-xform.js"],"sourcesContent":["const colCache = require('../../../utils/col-cache');\nconst BaseXform = require('../base-xform');\n\nconst VIEW_STATES = {\n  frozen: 'frozen',\n  frozenSplit: 'frozen',\n  split: 'split',\n};\n\nclass SheetViewXform extends BaseXform {\n  get tag() {\n    return 'sheetView';\n  }\n\n  prepare(model) {\n    switch (model.state) {\n      case 'frozen':\n      case 'split':\n        break;\n      default:\n        model.state = 'normal';\n        break;\n    }\n  }\n\n  render(xmlStream, model) {\n    xmlStream.openNode('sheetView', {\n      workbookViewId: model.workbookViewId || 0,\n    });\n    const add = function(name, value, included) {\n      if (included) {\n        xmlStream.addAttribute(name, value);\n      }\n    };\n    add('rightToLeft', '1', model.rightToLeft === true);\n    add('tabSelected', '1', model.tabSelected);\n    add('showRuler', '0', model.showRuler === false);\n    add('showRowColHeaders', '0', model.showRowColHeaders === false);\n    add('showGridLines', '0', model.showGridLines === false);\n    add('zoomScale', model.zoomScale, model.zoomScale);\n    add('zoomScaleNormal', model.zoomScaleNormal, model.zoomScaleNormal);\n    add('view', model.style, model.style);\n\n    let topLeftCell;\n    let xSplit;\n    let ySplit;\n    let activePane;\n    switch (model.state) {\n      case 'frozen':\n        xSplit = model.xSplit || 0;\n        ySplit = model.ySplit || 0;\n        topLeftCell = model.topLeftCell || colCache.getAddress(ySplit + 1, xSplit + 1).address;\n        activePane =\n          (model.xSplit && model.ySplit && 'bottomRight') ||\n          (model.xSplit && 'topRight') ||\n          'bottomLeft';\n\n        xmlStream.leafNode('pane', {\n          xSplit: model.xSplit || undefined,\n          ySplit: model.ySplit || undefined,\n          topLeftCell,\n          activePane,\n          state: 'frozen',\n        });\n        xmlStream.leafNode('selection', {\n          pane: activePane,\n          activeCell: model.activeCell,\n          sqref: model.activeCell,\n        });\n        break;\n      case 'split':\n        if (model.activePane === 'topLeft') {\n          model.activePane = undefined;\n        }\n        xmlStream.leafNode('pane', {\n          xSplit: model.xSplit || undefined,\n          ySplit: model.ySplit || undefined,\n          topLeftCell: model.topLeftCell,\n          activePane: model.activePane,\n        });\n        xmlStream.leafNode('selection', {\n          pane: model.activePane,\n          activeCell: model.activeCell,\n          sqref: model.activeCell,\n        });\n        break;\n      case 'normal':\n        if (model.activeCell) {\n          xmlStream.leafNode('selection', {\n            activeCell: model.activeCell,\n            sqref: model.activeCell,\n          });\n        }\n        break;\n      default:\n        break;\n    }\n    xmlStream.closeNode();\n  }\n\n  parseOpen(node) {\n    switch (node.name) {\n      case 'sheetView':\n        this.sheetView = {\n          workbookViewId: parseInt(node.attributes.workbookViewId, 10),\n          rightToLeft: node.attributes.rightToLeft === '1',\n          tabSelected: node.attributes.tabSelected === '1',\n          showRuler: !(node.attributes.showRuler === '0'),\n          showRowColHeaders: !(node.attributes.showRowColHeaders === '0'),\n          showGridLines: !(node.attributes.showGridLines === '0'),\n          zoomScale: parseInt(node.attributes.zoomScale || '100', 10),\n          zoomScaleNormal: parseInt(node.attributes.zoomScaleNormal || '100', 10),\n          style: node.attributes.view,\n        };\n        this.pane = undefined;\n        this.selections = {};\n        return true;\n\n      case 'pane':\n        this.pane = {\n          xSplit: parseInt(node.attributes.xSplit || '0', 10),\n          ySplit: parseInt(node.attributes.ySplit || '0', 10),\n          topLeftCell: node.attributes.topLeftCell,\n          activePane: node.attributes.activePane || 'topLeft',\n          state: node.attributes.state,\n        };\n        return true;\n\n      case 'selection': {\n        const name = node.attributes.pane || 'topLeft';\n        this.selections[name] = {\n          pane: name,\n          activeCell: node.attributes.activeCell,\n        };\n        return true;\n      }\n\n      default:\n        return false;\n    }\n  }\n\n  parseText() {}\n\n  parseClose(name) {\n    let model;\n    let selection;\n    switch (name) {\n      case 'sheetView':\n        if (this.sheetView && this.pane) {\n          model = this.model = {\n            workbookViewId: this.sheetView.workbookViewId,\n            rightToLeft: this.sheetView.rightToLeft,\n            state: VIEW_STATES[this.pane.state] || 'split', // split is default\n            xSplit: this.pane.xSplit,\n            ySplit: this.pane.ySplit,\n            topLeftCell: this.pane.topLeftCell,\n            showRuler: this.sheetView.showRuler,\n            showRowColHeaders: this.sheetView.showRowColHeaders,\n            showGridLines: this.sheetView.showGridLines,\n            zoomScale: this.sheetView.zoomScale,\n            zoomScaleNormal: this.sheetView.zoomScaleNormal,\n          };\n          if (this.model.state === 'split') {\n            model.activePane = this.pane.activePane;\n          }\n          selection = this.selections[this.pane.activePane];\n          if (selection && selection.activeCell) {\n            model.activeCell = selection.activeCell;\n          }\n          if (this.sheetView.style) {\n            model.style = this.sheetView.style;\n          }\n        } else {\n          model = this.model = {\n            workbookViewId: this.sheetView.workbookViewId,\n            rightToLeft: this.sheetView.rightToLeft,\n            state: 'normal',\n            showRuler: this.sheetView.showRuler,\n            showRowColHeaders: this.sheetView.showRowColHeaders,\n            showGridLines: this.sheetView.showGridLines,\n            zoomScale: this.sheetView.zoomScale,\n            zoomScaleNormal: this.sheetView.zoomScaleNormal,\n          };\n          selection = this.selections.topLeft;\n          if (selection && selection.activeCell) {\n            model.activeCell = selection.activeCell;\n          }\n          if (this.sheetView.style) {\n            model.style = this.sheetView.style;\n          }\n        }\n        return false;\n      default:\n        return true;\n    }\n  }\n\n  reconcile() {}\n}\n\nmodule.exports = SheetViewXform;\n"],"mappings":"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"}