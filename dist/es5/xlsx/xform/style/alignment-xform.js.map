{"version":3,"file":"alignment-xform.js","names":["Enums","require","utils","BaseXform","validation","horizontalValues","reduce","p","v","horizontal","value","undefined","verticalValues","vertical","wrapText","shrinkToFit","textRotation","validInt","indent","Math","max","readingOrder","ReadingOrder","LeftToRight","RightToLeft","textRotationXform","toXml","tr","round","toModel","AlignmentXform","xmlStream","model","addRollback","openNode","isValid","add","name","addAttribute","closeNode","commit","rollback","node","valid","truthy","attributes","parseBoolean","parseInt","module","exports"],"sources":["../../../../../lib/xlsx/xform/style/alignment-xform.js"],"sourcesContent":["const Enums = require('../../../doc/enums');\n\nconst utils = require('../../../utils/utils');\nconst BaseXform = require('../base-xform');\n\nconst validation = {\n  horizontalValues: [\n    'left',\n    'center',\n    'right',\n    'fill',\n    'centerContinuous',\n    'distributed',\n    'justify',\n  ].reduce((p, v) => {\n    p[v] = true;\n    return p;\n  }, {}),\n  horizontal(value) {\n    return this.horizontalValues[value] ? value : undefined;\n  },\n\n  verticalValues: ['top', 'middle', 'bottom', 'distributed', 'justify'].reduce((p, v) => {\n    p[v] = true;\n    return p;\n  }, {}),\n  vertical(value) {\n    if (value === 'middle') return 'center';\n    return this.verticalValues[value] ? value : undefined;\n  },\n  wrapText(value) {\n    return value ? true : undefined;\n  },\n  shrinkToFit(value) {\n    return value ? true : undefined;\n  },\n  textRotation(value) {\n    switch (value) {\n      case 'vertical':\n        return value;\n      default:\n        value = utils.validInt(value);\n        return value >= -90 && value <= 90 ? value : undefined;\n    }\n  },\n  indent(value) {\n    value = utils.validInt(value);\n    return Math.max(0, value);\n  },\n  readingOrder(value) {\n    switch (value) {\n      case 'ltr':\n        return Enums.ReadingOrder.LeftToRight;\n      case 'rtl':\n        return Enums.ReadingOrder.RightToLeft;\n      default:\n        return undefined;\n    }\n  },\n};\n\nconst textRotationXform = {\n  toXml(textRotation) {\n    textRotation = validation.textRotation(textRotation);\n    if (textRotation) {\n      if (textRotation === 'vertical') {\n        return 255;\n      }\n\n      const tr = Math.round(textRotation);\n      if (tr >= 0 && tr <= 90) {\n        return tr;\n      }\n\n      if (tr < 0 && tr >= -90) {\n        return 90 - tr;\n      }\n    }\n    return undefined;\n  },\n  toModel(textRotation) {\n    const tr = utils.validInt(textRotation);\n    if (tr !== undefined) {\n      if (tr === 255) {\n        return 'vertical';\n      }\n      if (tr >= 0 && tr <= 90) {\n        return tr;\n      }\n      if (tr > 90 && tr <= 180) {\n        return 90 - tr;\n      }\n    }\n    return undefined;\n  },\n};\n\n// Alignment encapsulates translation from style.alignment model to/from xlsx\nclass AlignmentXform extends BaseXform {\n  get tag() {\n    return 'alignment';\n  }\n\n  render(xmlStream, model) {\n    xmlStream.addRollback();\n    xmlStream.openNode('alignment');\n\n    let isValid = false;\n    function add(name, value) {\n      if (value) {\n        xmlStream.addAttribute(name, value);\n        isValid = true;\n      }\n    }\n    add('horizontal', validation.horizontal(model.horizontal));\n    add('vertical', validation.vertical(model.vertical));\n    add('wrapText', validation.wrapText(model.wrapText) ? '1' : false);\n    add('shrinkToFit', validation.shrinkToFit(model.shrinkToFit) ? '1' : false);\n    add('indent', validation.indent(model.indent));\n    add('textRotation', textRotationXform.toXml(model.textRotation));\n    add('readingOrder', validation.readingOrder(model.readingOrder));\n\n    xmlStream.closeNode();\n\n    if (isValid) {\n      xmlStream.commit();\n    } else {\n      xmlStream.rollback();\n    }\n  }\n\n  parseOpen(node) {\n    const model = {};\n\n    let valid = false;\n    function add(truthy, name, value) {\n      if (truthy) {\n        model[name] = value;\n        valid = true;\n      }\n    }\n    add(node.attributes.horizontal, 'horizontal', node.attributes.horizontal);\n    add(\n      node.attributes.vertical,\n      'vertical',\n      node.attributes.vertical === 'center' ? 'middle' : node.attributes.vertical\n    );\n    add(node.attributes.wrapText, 'wrapText', utils.parseBoolean(node.attributes.wrapText));\n    add(node.attributes.shrinkToFit, 'shrinkToFit', utils.parseBoolean(node.attributes.shrinkToFit));\n    add(node.attributes.indent, 'indent', parseInt(node.attributes.indent, 10));\n    add(\n      node.attributes.textRotation,\n      'textRotation',\n      textRotationXform.toModel(node.attributes.textRotation)\n    );\n    add(\n      node.attributes.readingOrder,\n      'readingOrder',\n      node.attributes.readingOrder === '2' ? 'rtl' : 'ltr'\n    );\n\n    this.model = valid ? model : null;\n  }\n\n  parseText() {}\n\n  parseClose() {\n    return false;\n  }\n}\n\nmodule.exports = AlignmentXform;\n"],"mappings":"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"}