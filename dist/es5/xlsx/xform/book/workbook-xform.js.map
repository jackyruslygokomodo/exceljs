{"version":3,"file":"workbook-xform.js","names":["_","require","colCache","XmlStream","BaseXform","StaticXform","ListXform","DefinedNameXform","SheetXform","WorkbookViewXform","WorkbookPropertiesXform","WorkbookCalcPropertiesXform","WorkbookXform","map","fileVersion","STATIC_XFORMS","workbookPr","bookViews","tag","count","childXform","sheets","definedNames","calcPr","model","worksheets","printAreas","index","forEach","sheet","pageSetup","printArea","split","printAreaComponents","definedName","name","ranges","localSheetId","push","printTitlesRow","printTitlesColumn","titlesColumns","titlesRows","length","concat","media","medium","i","type","xmlStream","openXml","StdDocAttributes","openNode","WORKBOOK_ATTRIBUTES","render","properties","views","calcProperties","closeNode","node","parser","parseOpen","text","parseText","parseClose","undefined","rels","workbookRels","reduce","rel","Id","worksheet","rId","worksheetHash","Target","replace","id","state","each","range","decodeEx","dimensions","rangeString","join","dollarRegex","rowRangeRegex","rowRangeMatches","match","columnRangeRegex","columnRangeMatches","xmlns","$","appName","lastEdited","lowestEdited","rupBuild","module","exports"],"sources":["../../../../../lib/xlsx/xform/book/workbook-xform.js"],"sourcesContent":["const _ = require('../../../utils/under-dash');\n\nconst colCache = require('../../../utils/col-cache');\nconst XmlStream = require('../../../utils/xml-stream');\n\nconst BaseXform = require('../base-xform');\nconst StaticXform = require('../static-xform');\nconst ListXform = require('../list-xform');\nconst DefinedNameXform = require('./defined-name-xform');\nconst SheetXform = require('./sheet-xform');\nconst WorkbookViewXform = require('./workbook-view-xform');\nconst WorkbookPropertiesXform = require('./workbook-properties-xform');\nconst WorkbookCalcPropertiesXform = require('./workbook-calc-properties-xform');\n\nclass WorkbookXform extends BaseXform {\n  constructor() {\n    super();\n\n    this.map = {\n      fileVersion: WorkbookXform.STATIC_XFORMS.fileVersion,\n      workbookPr: new WorkbookPropertiesXform(),\n      bookViews: new ListXform({\n        tag: 'bookViews',\n        count: false,\n        childXform: new WorkbookViewXform(),\n      }),\n      sheets: new ListXform({tag: 'sheets', count: false, childXform: new SheetXform()}),\n      definedNames: new ListXform({\n        tag: 'definedNames',\n        count: false,\n        childXform: new DefinedNameXform(),\n      }),\n      calcPr: new WorkbookCalcPropertiesXform(),\n    };\n  }\n\n  prepare(model) {\n    model.sheets = model.worksheets;\n\n    // collate all the print areas from all of the sheets and add them to the defined names\n    const printAreas = [];\n    let index = 0; // sheets is sparse array - calc index manually\n    model.sheets.forEach(sheet => {\n      if (sheet.pageSetup && sheet.pageSetup.printArea) {\n        sheet.pageSetup.printArea.split('&&').forEach(printArea => {\n          const printAreaComponents = printArea.split(':');\n          const definedName = {\n            name: '_xlnm.Print_Area',\n            ranges: [`'${sheet.name}'!$${printAreaComponents[0]}:$${printAreaComponents[1]}`],\n            localSheetId: index,\n          };\n          printAreas.push(definedName);\n        });\n      }\n\n      if (\n        sheet.pageSetup &&\n        (sheet.pageSetup.printTitlesRow || sheet.pageSetup.printTitlesColumn)\n      ) {\n        const ranges = [];\n\n        if (sheet.pageSetup.printTitlesColumn) {\n          const titlesColumns = sheet.pageSetup.printTitlesColumn.split(':');\n          ranges.push(`'${sheet.name}'!$${titlesColumns[0]}:$${titlesColumns[1]}`);\n        }\n\n        if (sheet.pageSetup.printTitlesRow) {\n          const titlesRows = sheet.pageSetup.printTitlesRow.split(':');\n          ranges.push(`'${sheet.name}'!$${titlesRows[0]}:$${titlesRows[1]}`);\n        }\n\n        const definedName = {\n          name: '_xlnm.Print_Titles',\n          ranges,\n          localSheetId: index,\n        };\n\n        printAreas.push(definedName);\n      }\n      index++;\n    });\n    if (printAreas.length) {\n      model.definedNames = model.definedNames.concat(printAreas);\n    }\n\n    (model.media || []).forEach((medium, i) => {\n      // assign name\n      medium.name = medium.type + (i + 1);\n    });\n  }\n\n  render(xmlStream, model) {\n    xmlStream.openXml(XmlStream.StdDocAttributes);\n    xmlStream.openNode('workbook', WorkbookXform.WORKBOOK_ATTRIBUTES);\n\n    this.map.fileVersion.render(xmlStream);\n    this.map.workbookPr.render(xmlStream, model.properties);\n    this.map.bookViews.render(xmlStream, model.views);\n    this.map.sheets.render(xmlStream, model.sheets);\n    this.map.definedNames.render(xmlStream, model.definedNames);\n    this.map.calcPr.render(xmlStream, model.calcProperties);\n\n    xmlStream.closeNode();\n  }\n\n  parseOpen(node) {\n    if (this.parser) {\n      this.parser.parseOpen(node);\n      return true;\n    }\n    switch (node.name) {\n      case 'workbook':\n        return true;\n      default:\n        this.parser = this.map[node.name];\n        if (this.parser) {\n          this.parser.parseOpen(node);\n        }\n        return true;\n    }\n  }\n\n  parseText(text) {\n    if (this.parser) {\n      this.parser.parseText(text);\n    }\n  }\n\n  parseClose(name) {\n    if (this.parser) {\n      if (!this.parser.parseClose(name)) {\n        this.parser = undefined;\n      }\n      return true;\n    }\n    switch (name) {\n      case 'workbook':\n        this.model = {\n          sheets: this.map.sheets.model,\n          properties: this.map.workbookPr.model || {},\n          views: this.map.bookViews.model,\n          calcProperties: {},\n        };\n        if (this.map.definedNames.model) {\n          this.model.definedNames = this.map.definedNames.model;\n        }\n\n        return false;\n      default:\n        // not quite sure how we get here!\n        return true;\n    }\n  }\n\n  reconcile(model) {\n    const rels = (model.workbookRels || []).reduce((map, rel) => {\n      map[rel.Id] = rel;\n      return map;\n    }, {});\n\n    // reconcile sheet ids, rIds and names\n    const worksheets = [];\n    let worksheet;\n    let index = 0;\n\n    (model.sheets || []).forEach(sheet => {\n      const rel = rels[sheet.rId];\n      if (!rel) {\n        return;\n      }\n      // if rel.Target start with `[space]/xl/` or `/xl/` , then it will be replaced with `''` and spliced behind `xl/`,\n      // otherwise it will be spliced directly behind `xl/`. i.g.\n      worksheet = model.worksheetHash[`xl/${rel.Target.replace(/^(\\s|\\/xl\\/)+/, '')}`];\n      // If there are \"chartsheets\" in the file, rel.Target will\n      // come out as chartsheets/sheet1.xml or similar here, and\n      // that won't be in model.worksheetHash.\n      // As we don't have the infrastructure to support chartsheets,\n      // we will ignore them for now:\n      if (worksheet) {\n        worksheet.name = sheet.name;\n        worksheet.id = sheet.id;\n        worksheet.state = sheet.state;\n        worksheets[index++] = worksheet;\n      }\n    });\n\n    // reconcile print areas\n    const definedNames = [];\n    _.each(model.definedNames, definedName => {\n      if (definedName.name === '_xlnm.Print_Area') {\n        worksheet = worksheets[definedName.localSheetId];\n        if (worksheet) {\n          if (!worksheet.pageSetup) {\n            worksheet.pageSetup = {};\n          }\n          const range = colCache.decodeEx(definedName.ranges[0]);\n          worksheet.pageSetup.printArea = worksheet.pageSetup.printArea\n            ? `${worksheet.pageSetup.printArea}&&${range.dimensions}`\n            : range.dimensions;\n        }\n      } else if (definedName.name === '_xlnm.Print_Titles') {\n        worksheet = worksheets[definedName.localSheetId];\n        if (worksheet) {\n          if (!worksheet.pageSetup) {\n            worksheet.pageSetup = {};\n          }\n\n          const rangeString = definedName.ranges.join(',');\n\n          const dollarRegex = /\\$/g;\n\n          const rowRangeRegex = /\\$\\d+:\\$\\d+/;\n          const rowRangeMatches = rangeString.match(rowRangeRegex);\n\n          if (rowRangeMatches && rowRangeMatches.length) {\n            const range = rowRangeMatches[0];\n            worksheet.pageSetup.printTitlesRow = range.replace(dollarRegex, '');\n          }\n\n          const columnRangeRegex = /\\$[A-Z]+:\\$[A-Z]+/;\n          const columnRangeMatches = rangeString.match(columnRangeRegex);\n\n          if (columnRangeMatches && columnRangeMatches.length) {\n            const range = columnRangeMatches[0];\n            worksheet.pageSetup.printTitlesColumn = range.replace(dollarRegex, '');\n          }\n        }\n      } else {\n        definedNames.push(definedName);\n      }\n    });\n    model.definedNames = definedNames;\n\n    // used by sheets to build their image models\n    model.media.forEach((media, i) => {\n      media.index = i;\n    });\n  }\n}\n\nWorkbookXform.WORKBOOK_ATTRIBUTES = {\n  xmlns: 'http://schemas.openxmlformats.org/spreadsheetml/2006/main',\n  'xmlns:r': 'http://schemas.openxmlformats.org/officeDocument/2006/relationships',\n  'xmlns:mc': 'http://schemas.openxmlformats.org/markup-compatibility/2006',\n  'mc:Ignorable': 'x15',\n  'xmlns:x15': 'http://schemas.microsoft.com/office/spreadsheetml/2010/11/main',\n};\nWorkbookXform.STATIC_XFORMS = {\n  fileVersion: new StaticXform({\n    tag: 'fileVersion',\n    $: {appName: 'xl', lastEdited: 5, lowestEdited: 5, rupBuild: 9303},\n  }),\n};\n\nmodule.exports = WorkbookXform;\n"],"mappings":"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"}