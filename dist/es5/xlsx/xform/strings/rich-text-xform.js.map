{"version":3,"file":"rich-text-xform.js","names":["TextXform","require","FontXform","BaseXform","RichTextXform","model","_textXform","_fontXform","FONT_OPTIONS","xmlStream","openNode","font","fontXform","render","textXform","text","closeNode","node","parser","parseOpen","name","parseText","undefined","parseClose","tagName","fontNameTag","module","exports"],"sources":["../../../../../lib/xlsx/xform/strings/rich-text-xform.js"],"sourcesContent":["const TextXform = require('./text-xform');\nconst FontXform = require('../style/font-xform');\n\nconst BaseXform = require('../base-xform');\n\n// <r>\n//   <rPr>\n//     <sz val=\"11\"/>\n//     <color theme=\"1\" tint=\"5\"/>\n//     <rFont val=\"Calibri\"/>\n//     <family val=\"2\"/>\n//     <scheme val=\"minor\"/>\n//   </rPr>\n//   <t xml:space=\"preserve\"> is </t>\n// </r>\n\nclass RichTextXform extends BaseXform {\n  constructor(model) {\n    super();\n\n    this.model = model;\n  }\n\n  get tag() {\n    return 'r';\n  }\n\n  get textXform() {\n    return this._textXform || (this._textXform = new TextXform());\n  }\n\n  get fontXform() {\n    return this._fontXform || (this._fontXform = new FontXform(RichTextXform.FONT_OPTIONS));\n  }\n\n  render(xmlStream, model) {\n    model = model || this.model;\n\n    xmlStream.openNode('r');\n    if (model.font) {\n      this.fontXform.render(xmlStream, model.font);\n    }\n    this.textXform.render(xmlStream, model.text);\n    xmlStream.closeNode();\n  }\n\n  parseOpen(node) {\n    if (this.parser) {\n      this.parser.parseOpen(node);\n      return true;\n    }\n    switch (node.name) {\n      case 'r':\n        this.model = {};\n        return true;\n      case 't':\n        this.parser = this.textXform;\n        this.parser.parseOpen(node);\n        return true;\n      case 'rPr':\n        this.parser = this.fontXform;\n        this.parser.parseOpen(node);\n        return true;\n      default:\n        return false;\n    }\n  }\n\n  parseText(text) {\n    if (this.parser) {\n      this.parser.parseText(text);\n    }\n  }\n\n  parseClose(name) {\n    switch (name) {\n      case 'r':\n        return false;\n      case 't':\n        this.model.text = this.parser.model;\n        this.parser = undefined;\n        return true;\n      case 'rPr':\n        this.model.font = this.parser.model;\n        this.parser = undefined;\n        return true;\n      default:\n        if (this.parser) {\n          this.parser.parseClose(name);\n        }\n        return true;\n    }\n  }\n}\n\nRichTextXform.FONT_OPTIONS = {\n  tagName: 'rPr',\n  fontNameTag: 'rFont',\n};\n\nmodule.exports = RichTextXform;\n"],"mappings":"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"}