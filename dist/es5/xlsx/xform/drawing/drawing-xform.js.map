{"version":3,"file":"drawing-xform.js","names":["colCache","require","XmlStream","BaseXform","TwoCellAnchorXform","OneCellAnchorXform","getAnchorType","model","range","decode","br","DrawingXform","map","anchors","forEach","item","index","anchorType","anchor","prepare","xmlStream","openXml","StdDocAttributes","openNode","tag","DRAWING_ATTRIBUTES","render","closeNode","node","parser","parseOpen","name","reset","text","parseText","parseClose","push","undefined","options","reconcile","module","exports"],"sources":["../../../../../lib/xlsx/xform/drawing/drawing-xform.js"],"sourcesContent":["const colCache = require('../../../utils/col-cache');\nconst XmlStream = require('../../../utils/xml-stream');\n\nconst BaseXform = require('../base-xform');\nconst TwoCellAnchorXform = require('./two-cell-anchor-xform');\nconst OneCellAnchorXform = require('./one-cell-anchor-xform');\n\nfunction getAnchorType(model) {\n  const range = typeof model.range === 'string' ? colCache.decode(model.range) : model.range;\n\n  return range.br ? 'xdr:twoCellAnchor' : 'xdr:oneCellAnchor';\n}\n\nclass DrawingXform extends BaseXform {\n  constructor() {\n    super();\n\n    this.map = {\n      'xdr:twoCellAnchor': new TwoCellAnchorXform(),\n      'xdr:oneCellAnchor': new OneCellAnchorXform(),\n    };\n  }\n\n  prepare(model) {\n    model.anchors.forEach((item, index) => {\n      item.anchorType = getAnchorType(item);\n      const anchor = this.map[item.anchorType];\n      anchor.prepare(item, {index});\n    });\n  }\n\n  get tag() {\n    return 'xdr:wsDr';\n  }\n\n  render(xmlStream, model) {\n    xmlStream.openXml(XmlStream.StdDocAttributes);\n    xmlStream.openNode(this.tag, DrawingXform.DRAWING_ATTRIBUTES);\n\n    model.anchors.forEach(item => {\n      const anchor = this.map[item.anchorType];\n      anchor.render(xmlStream, item);\n    });\n\n    xmlStream.closeNode();\n  }\n\n  parseOpen(node) {\n    if (this.parser) {\n      this.parser.parseOpen(node);\n      return true;\n    }\n    switch (node.name) {\n      case this.tag:\n        this.reset();\n        this.model = {\n          anchors: [],\n        };\n        break;\n      default:\n        this.parser = this.map[node.name];\n        if (this.parser) {\n          this.parser.parseOpen(node);\n        }\n        break;\n    }\n    return true;\n  }\n\n  parseText(text) {\n    if (this.parser) {\n      this.parser.parseText(text);\n    }\n  }\n\n  parseClose(name) {\n    if (this.parser) {\n      if (!this.parser.parseClose(name)) {\n        this.model.anchors.push(this.parser.model);\n        this.parser = undefined;\n      }\n      return true;\n    }\n    switch (name) {\n      case this.tag:\n        return false;\n      default:\n        // could be some unrecognised tags\n        return true;\n    }\n  }\n\n  reconcile(model, options) {\n    model.anchors.forEach(anchor => {\n      if (anchor.br) {\n        this.map['xdr:twoCellAnchor'].reconcile(anchor, options);\n      } else {\n        this.map['xdr:oneCellAnchor'].reconcile(anchor, options);\n      }\n    });\n  }\n}\n\nDrawingXform.DRAWING_ATTRIBUTES = {\n  'xmlns:xdr': 'http://schemas.openxmlformats.org/drawingml/2006/spreadsheetDrawing',\n  'xmlns:a': 'http://schemas.openxmlformats.org/drawingml/2006/main',\n};\n\nmodule.exports = DrawingXform;\n"],"mappings":";;;;;;;;;;;;;;;AAAA,IAAMA,QAAQ,GAAGC,OAAO,CAAC,0BAA0B,CAAC;AACpD,IAAMC,SAAS,GAAGD,OAAO,CAAC,2BAA2B,CAAC;AAEtD,IAAME,SAAS,GAAGF,OAAO,CAAC,eAAe,CAAC;AAC1C,IAAMG,kBAAkB,GAAGH,OAAO,CAAC,yBAAyB,CAAC;AAC7D,IAAMI,kBAAkB,GAAGJ,OAAO,CAAC,yBAAyB,CAAC;AAE7D,SAASK,aAAa,CAACC,KAAK,EAAE;EAC5B,IAAMC,KAAK,GAAG,OAAOD,KAAK,CAACC,KAAK,KAAK,QAAQ,GAAGR,QAAQ,CAACS,MAAM,CAACF,KAAK,CAACC,KAAK,CAAC,GAAGD,KAAK,CAACC,KAAK;EAE1F,OAAOA,KAAK,CAACE,EAAE,GAAG,mBAAmB,GAAG,mBAAmB;AAC7D;AAAC,IAEKC,YAAY;EAAA;EAAA;EAChB,wBAAc;IAAA;IAAA;IACZ;IAEA,MAAKC,GAAG,GAAG;MACT,mBAAmB,EAAE,IAAIR,kBAAkB,EAAE;MAC7C,mBAAmB,EAAE,IAAIC,kBAAkB;IAC7C,CAAC;IAAC;EACJ;EAAC;IAAA;IAAA,OAED,iBAAQE,KAAK,EAAE;MAAA;MACbA,KAAK,CAACM,OAAO,CAACC,OAAO,CAAC,UAACC,IAAI,EAAEC,KAAK,EAAK;QACrCD,IAAI,CAACE,UAAU,GAAGX,aAAa,CAACS,IAAI,CAAC;QACrC,IAAMG,MAAM,GAAG,MAAI,CAACN,GAAG,CAACG,IAAI,CAACE,UAAU,CAAC;QACxCC,MAAM,CAACC,OAAO,CAACJ,IAAI,EAAE;UAACC,KAAK,EAALA;QAAK,CAAC,CAAC;MAC/B,CAAC,CAAC;IACJ;EAAC;IAAA;IAAA,KAED,eAAU;MACR,OAAO,UAAU;IACnB;EAAC;IAAA;IAAA,OAED,gBAAOI,SAAS,EAAEb,KAAK,EAAE;MAAA;MACvBa,SAAS,CAACC,OAAO,CAACnB,SAAS,CAACoB,gBAAgB,CAAC;MAC7CF,SAAS,CAACG,QAAQ,CAAC,IAAI,CAACC,GAAG,EAAEb,YAAY,CAACc,kBAAkB,CAAC;MAE7DlB,KAAK,CAACM,OAAO,CAACC,OAAO,CAAC,UAAAC,IAAI,EAAI;QAC5B,IAAMG,MAAM,GAAG,MAAI,CAACN,GAAG,CAACG,IAAI,CAACE,UAAU,CAAC;QACxCC,MAAM,CAACQ,MAAM,CAACN,SAAS,EAAEL,IAAI,CAAC;MAChC,CAAC,CAAC;MAEFK,SAAS,CAACO,SAAS,EAAE;IACvB;EAAC;IAAA;IAAA,OAED,mBAAUC,IAAI,EAAE;MACd,IAAI,IAAI,CAACC,MAAM,EAAE;QACf,IAAI,CAACA,MAAM,CAACC,SAAS,CAACF,IAAI,CAAC;QAC3B,OAAO,IAAI;MACb;MACA,QAAQA,IAAI,CAACG,IAAI;QACf,KAAK,IAAI,CAACP,GAAG;UACX,IAAI,CAACQ,KAAK,EAAE;UACZ,IAAI,CAACzB,KAAK,GAAG;YACXM,OAAO,EAAE;UACX,CAAC;UACD;QACF;UACE,IAAI,CAACgB,MAAM,GAAG,IAAI,CAACjB,GAAG,CAACgB,IAAI,CAACG,IAAI,CAAC;UACjC,IAAI,IAAI,CAACF,MAAM,EAAE;YACf,IAAI,CAACA,MAAM,CAACC,SAAS,CAACF,IAAI,CAAC;UAC7B;UACA;MAAM;MAEV,OAAO,IAAI;IACb;EAAC;IAAA;IAAA,OAED,mBAAUK,IAAI,EAAE;MACd,IAAI,IAAI,CAACJ,MAAM,EAAE;QACf,IAAI,CAACA,MAAM,CAACK,SAAS,CAACD,IAAI,CAAC;MAC7B;IACF;EAAC;IAAA;IAAA,OAED,oBAAWF,IAAI,EAAE;MACf,IAAI,IAAI,CAACF,MAAM,EAAE;QACf,IAAI,CAAC,IAAI,CAACA,MAAM,CAACM,UAAU,CAACJ,IAAI,CAAC,EAAE;UACjC,IAAI,CAACxB,KAAK,CAACM,OAAO,CAACuB,IAAI,CAAC,IAAI,CAACP,MAAM,CAACtB,KAAK,CAAC;UAC1C,IAAI,CAACsB,MAAM,GAAGQ,SAAS;QACzB;QACA,OAAO,IAAI;MACb;MACA,QAAQN,IAAI;QACV,KAAK,IAAI,CAACP,GAAG;UACX,OAAO,KAAK;QACd;UACE;UACA,OAAO,IAAI;MAAC;IAElB;EAAC;IAAA;IAAA,OAED,mBAAUjB,KAAK,EAAE+B,OAAO,EAAE;MAAA;MACxB/B,KAAK,CAACM,OAAO,CAACC,OAAO,CAAC,UAAAI,MAAM,EAAI;QAC9B,IAAIA,MAAM,CAACR,EAAE,EAAE;UACb,MAAI,CAACE,GAAG,CAAC,mBAAmB,CAAC,CAAC2B,SAAS,CAACrB,MAAM,EAAEoB,OAAO,CAAC;QAC1D,CAAC,MAAM;UACL,MAAI,CAAC1B,GAAG,CAAC,mBAAmB,CAAC,CAAC2B,SAAS,CAACrB,MAAM,EAAEoB,OAAO,CAAC;QAC1D;MACF,CAAC,CAAC;IACJ;EAAC;EAAA;AAAA,EAvFwBnC,SAAS;AA0FpCQ,YAAY,CAACc,kBAAkB,GAAG;EAChC,WAAW,EAAE,qEAAqE;EAClF,SAAS,EAAE;AACb,CAAC;AAEDe,MAAM,CAACC,OAAO,GAAG9B,YAAY"}