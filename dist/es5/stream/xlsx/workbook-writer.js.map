{"version":3,"file":"workbook-writer.js","names":["fs","require","Archiver","StreamBuf","RelType","StylesXform","SharedStrings","DefinedNames","CoreXform","RelationshipsXform","ContentTypesXform","AppXform","WorkbookXform","SharedStringsXform","WorksheetWriter","theme1Xml","WorkbookWriter","options","created","Date","modified","creator","lastModifiedBy","lastPrinted","useSharedStrings","sharedStrings","styles","useStyles","Mock","_definedNames","_worksheets","views","zipOptions","zip","media","commentRefs","stream","filename","createWriteStream","pipe","promise","Promise","all","addThemes","addOfficeRels","path","bufSize","batch","append","name","on","emit","commitWorksheet","worksheet","committed","resolve","commit","promises","map","length","addMedia","_commitWorksheets","addContentTypes","addApp","addCore","addSharedStrings","addStyles","addWorkbookRels","addWorkbook","_finalize","i","image","id","medium","Object","assign","type","extension","push","undefined","tabColor","console","trace","properties","nextId","workbook","state","pageSetup","autoFilter","headerFooter","find","xml","xform","toXml","Id","Type","OfficeDocument","Target","CoreProperties","ExtenderProperties","model","worksheets","filter","Boolean","file","buffer","base64","dataimg64","content","substring","indexOf","Error","coreXform","count","sharedStringsXform","relationships","Styles","Theme","forEach","rId","Worksheet","definedNames","calcProperties","prepare","reject","finalize","module","exports"],"sources":["../../../../lib/stream/xlsx/workbook-writer.js"],"sourcesContent":["const fs = require('fs');\nconst Archiver = require('archiver');\n\nconst StreamBuf = require('../../utils/stream-buf');\n\nconst RelType = require('../../xlsx/rel-type');\nconst StylesXform = require('../../xlsx/xform/style/styles-xform');\nconst SharedStrings = require('../../utils/shared-strings');\nconst DefinedNames = require('../../doc/defined-names');\n\nconst CoreXform = require('../../xlsx/xform/core/core-xform');\nconst RelationshipsXform = require('../../xlsx/xform/core/relationships-xform');\nconst ContentTypesXform = require('../../xlsx/xform/core/content-types-xform');\nconst AppXform = require('../../xlsx/xform/core/app-xform');\nconst WorkbookXform = require('../../xlsx/xform/book/workbook-xform');\nconst SharedStringsXform = require('../../xlsx/xform/strings/shared-strings-xform');\n\nconst WorksheetWriter = require('./worksheet-writer');\n\nconst theme1Xml = require('../../xlsx/xml/theme1.js');\n\nclass WorkbookWriter {\n  constructor(options) {\n    options = options || {};\n\n    this.created = options.created || new Date();\n    this.modified = options.modified || this.created;\n    this.creator = options.creator || 'ExcelJS';\n    this.lastModifiedBy = options.lastModifiedBy || 'ExcelJS';\n    this.lastPrinted = options.lastPrinted;\n\n    // using shared strings creates a smaller xlsx file but may use more memory\n    this.useSharedStrings = options.useSharedStrings || false;\n    this.sharedStrings = new SharedStrings();\n\n    // style manager\n    this.styles = options.useStyles ? new StylesXform(true) : new StylesXform.Mock(true);\n\n    // defined names\n    this._definedNames = new DefinedNames();\n\n    this._worksheets = [];\n    this.views = [];\n\n    this.zipOptions = options.zip;\n\n    this.media = [];\n    this.commentRefs = [];\n\n    this.zip = Archiver('zip', this.zipOptions);\n    if (options.stream) {\n      this.stream = options.stream;\n    } else if (options.filename) {\n      this.stream = fs.createWriteStream(options.filename);\n    } else {\n      this.stream = new StreamBuf();\n    }\n    this.zip.pipe(this.stream);\n\n    // these bits can be added right now\n    this.promise = Promise.all([this.addThemes(), this.addOfficeRels()]);\n  }\n\n  get definedNames() {\n    return this._definedNames;\n  }\n\n  _openStream(path) {\n    const stream = new StreamBuf({bufSize: 65536, batch: true});\n    this.zip.append(stream, {name: path});\n    stream.on('finish', () => {\n      stream.emit('zipped');\n    });\n    return stream;\n  }\n\n  _commitWorksheets() {\n    const commitWorksheet = function(worksheet) {\n      if (!worksheet.committed) {\n        return new Promise(resolve => {\n          worksheet.stream.on('zipped', () => {\n            resolve();\n          });\n          worksheet.commit();\n        });\n      }\n      return Promise.resolve();\n    };\n    // if there are any uncommitted worksheets, commit them now and wait\n    const promises = this._worksheets.map(commitWorksheet);\n    if (promises.length) {\n      return Promise.all(promises);\n    }\n    return Promise.resolve();\n  }\n\n  async commit() {\n    // commit all worksheets, then add suplimentary files\n    await this.promise;\n    await this.addMedia();\n    await this._commitWorksheets();\n    await Promise.all([\n      this.addContentTypes(),\n      this.addApp(),\n      this.addCore(),\n      this.addSharedStrings(),\n      this.addStyles(),\n      this.addWorkbookRels(),\n    ]);\n    await this.addWorkbook();\n    return this._finalize();\n  }\n\n  get nextId() {\n    // find the next unique spot to add worksheet\n    let i;\n    for (i = 1; i < this._worksheets.length; i++) {\n      if (!this._worksheets[i]) {\n        return i;\n      }\n    }\n    return this._worksheets.length || 1;\n  }\n\n  addImage(image) {\n    const id = this.media.length;\n    const medium = Object.assign({}, image, {type: 'image', name: `image${id}.${image.extension}`});\n    this.media.push(medium);\n    return id;\n  }\n\n  getImage(id) {\n    return this.media[id];\n  }\n\n  addWorksheet(name, options) {\n    // it's possible to add a worksheet with different than default\n    // shared string handling\n    // in fact, it's even possible to switch it mid-sheet\n    options = options || {};\n    const useSharedStrings =\n      options.useSharedStrings !== undefined ? options.useSharedStrings : this.useSharedStrings;\n\n    if (options.tabColor) {\n      // eslint-disable-next-line no-console\n      console.trace('tabColor option has moved to { properties: tabColor: {...} }');\n      options.properties = Object.assign(\n        {\n          tabColor: options.tabColor,\n        },\n        options.properties\n      );\n    }\n\n    const id = this.nextId;\n    name = name || `sheet${id}`;\n\n    const worksheet = new WorksheetWriter({\n      id,\n      name,\n      workbook: this,\n      useSharedStrings,\n      properties: options.properties,\n      state: options.state,\n      pageSetup: options.pageSetup,\n      views: options.views,\n      autoFilter: options.autoFilter,\n      headerFooter: options.headerFooter,\n    });\n\n    this._worksheets[id] = worksheet;\n    return worksheet;\n  }\n\n  getWorksheet(id) {\n    if (id === undefined) {\n      return this._worksheets.find(() => true);\n    }\n    if (typeof id === 'number') {\n      return this._worksheets[id];\n    }\n    if (typeof id === 'string') {\n      return this._worksheets.find(worksheet => worksheet && worksheet.name === id);\n    }\n    return undefined;\n  }\n\n  addStyles() {\n    return new Promise(resolve => {\n      this.zip.append(this.styles.xml, {name: 'xl/styles.xml'});\n      resolve();\n    });\n  }\n\n  addThemes() {\n    return new Promise(resolve => {\n      this.zip.append(theme1Xml, {name: 'xl/theme/theme1.xml'});\n      resolve();\n    });\n  }\n\n  addOfficeRels() {\n    return new Promise(resolve => {\n      const xform = new RelationshipsXform();\n      const xml = xform.toXml([\n        {Id: 'rId1', Type: RelType.OfficeDocument, Target: 'xl/workbook.xml'},\n        {Id: 'rId2', Type: RelType.CoreProperties, Target: 'docProps/core.xml'},\n        {Id: 'rId3', Type: RelType.ExtenderProperties, Target: 'docProps/app.xml'},\n      ]);\n      this.zip.append(xml, {name: '/_rels/.rels'});\n      resolve();\n    });\n  }\n\n  addContentTypes() {\n    return new Promise(resolve => {\n      const model = {\n        worksheets: this._worksheets.filter(Boolean),\n        sharedStrings: this.sharedStrings,\n        commentRefs: this.commentRefs,\n        media: this.media,\n      };\n      const xform = new ContentTypesXform();\n      const xml = xform.toXml(model);\n      this.zip.append(xml, {name: '[Content_Types].xml'});\n      resolve();\n    });\n  }\n\n  addMedia() {\n    return Promise.all(\n      this.media.map(medium => {\n        if (medium.type === 'image') {\n          const filename = `xl/media/${medium.name}`;\n          if (medium.filename) {\n            return this.zip.file(medium.filename, {name: filename});\n          }\n          if (medium.buffer) {\n            return this.zip.append(medium.buffer, {name: filename});\n          }\n          if (medium.base64) {\n            const dataimg64 = medium.base64;\n            const content = dataimg64.substring(dataimg64.indexOf(',') + 1);\n            return this.zip.append(content, {name: filename, base64: true});\n          }\n        }\n        throw new Error('Unsupported media');\n      })\n    );\n  }\n\n  addApp() {\n    return new Promise(resolve => {\n      const model = {\n        worksheets: this._worksheets.filter(Boolean),\n      };\n      const xform = new AppXform();\n      const xml = xform.toXml(model);\n      this.zip.append(xml, {name: 'docProps/app.xml'});\n      resolve();\n    });\n  }\n\n  addCore() {\n    return new Promise(resolve => {\n      const coreXform = new CoreXform();\n      const xml = coreXform.toXml(this);\n      this.zip.append(xml, {name: 'docProps/core.xml'});\n      resolve();\n    });\n  }\n\n  addSharedStrings() {\n    if (this.sharedStrings.count) {\n      return new Promise(resolve => {\n        const sharedStringsXform = new SharedStringsXform();\n        const xml = sharedStringsXform.toXml(this.sharedStrings);\n        this.zip.append(xml, {name: '/xl/sharedStrings.xml'});\n        resolve();\n      });\n    }\n    return Promise.resolve();\n  }\n\n  addWorkbookRels() {\n    let count = 1;\n    const relationships = [\n      {Id: `rId${count++}`, Type: RelType.Styles, Target: 'styles.xml'},\n      {Id: `rId${count++}`, Type: RelType.Theme, Target: 'theme/theme1.xml'},\n    ];\n    if (this.sharedStrings.count) {\n      relationships.push({\n        Id: `rId${count++}`,\n        Type: RelType.SharedStrings,\n        Target: 'sharedStrings.xml',\n      });\n    }\n    this._worksheets.forEach(worksheet => {\n      if (worksheet) {\n        worksheet.rId = `rId${count++}`;\n        relationships.push({\n          Id: worksheet.rId,\n          Type: RelType.Worksheet,\n          Target: `worksheets/sheet${worksheet.id}.xml`,\n        });\n      }\n    });\n    return new Promise(resolve => {\n      const xform = new RelationshipsXform();\n      const xml = xform.toXml(relationships);\n      this.zip.append(xml, {name: '/xl/_rels/workbook.xml.rels'});\n      resolve();\n    });\n  }\n\n  addWorkbook() {\n    const {zip} = this;\n    const model = {\n      worksheets: this._worksheets.filter(Boolean),\n      definedNames: this._definedNames.model,\n      views: this.views,\n      properties: {},\n      calcProperties: {},\n    };\n\n    return new Promise(resolve => {\n      const xform = new WorkbookXform();\n      xform.prepare(model);\n      zip.append(xform.toXml(model), {name: '/xl/workbook.xml'});\n      resolve();\n    });\n  }\n\n  _finalize() {\n    return new Promise((resolve, reject) => {\n      this.stream.on('error', reject);\n      this.stream.on('finish', () => {\n        resolve(this);\n      });\n      this.zip.on('error', reject);\n\n      this.zip.finalize();\n    });\n  }\n}\n\nmodule.exports = WorkbookWriter;\n"],"mappings":"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"}