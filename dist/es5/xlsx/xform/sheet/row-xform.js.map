{"version":3,"file":"row-xform.js","names":["BaseXform","require","utils","CellXform","RowXform","options","maxItems","map","c","model","styleId","styles","addStyleModel","style","cellXform","cells","forEach","cellModel","prepare","xmlStream","openNode","addAttribute","number","height","hidden","min","max","outlineLevel","collapsed","render","closeNode","node","parser","parseOpen","name","numRowsSeen","spans","attributes","split","span","parseInt","undefined","r","s","parseBoolean","bestFit","ht","parseFloat","text","parseText","parseClose","push","length","Error","getStyleModel","reconcile","module","exports"],"sources":["../../../../../lib/xlsx/xform/sheet/row-xform.js"],"sourcesContent":["const BaseXform = require('../base-xform');\nconst utils = require('../../../utils/utils');\n\nconst CellXform = require('./cell-xform');\n\nclass RowXform extends BaseXform {\n  constructor(options) {\n    super();\n\n    this.maxItems = options && options.maxItems;\n    this.map = {\n      c: new CellXform(),\n    };\n  }\n\n  get tag() {\n    return 'row';\n  }\n\n  prepare(model, options) {\n    const styleId = options.styles.addStyleModel(model.style);\n    if (styleId) {\n      model.styleId = styleId;\n    }\n    const cellXform = this.map.c;\n    model.cells.forEach(cellModel => {\n      cellXform.prepare(cellModel, options);\n    });\n  }\n\n  render(xmlStream, model, options) {\n    xmlStream.openNode('row');\n    xmlStream.addAttribute('r', model.number);\n    if (model.height) {\n      xmlStream.addAttribute('ht', model.height);\n      xmlStream.addAttribute('customHeight', '1');\n    }\n    if (model.hidden) {\n      xmlStream.addAttribute('hidden', '1');\n    }\n    if (model.min > 0 && model.max > 0 && model.min <= model.max) {\n      xmlStream.addAttribute('spans', `${model.min}:${model.max}`);\n    }\n    if (model.styleId) {\n      xmlStream.addAttribute('s', model.styleId);\n      xmlStream.addAttribute('customFormat', '1');\n    }\n    xmlStream.addAttribute('x14ac:dyDescent', '0.25');\n    if (model.outlineLevel) {\n      xmlStream.addAttribute('outlineLevel', model.outlineLevel);\n    }\n    if (model.collapsed) {\n      xmlStream.addAttribute('collapsed', '1');\n    }\n\n    const cellXform = this.map.c;\n    model.cells.forEach(cellModel => {\n      cellXform.render(xmlStream, cellModel, options);\n    });\n\n    xmlStream.closeNode();\n  }\n\n  parseOpen(node) {\n    if (this.parser) {\n      this.parser.parseOpen(node);\n      return true;\n    }\n    if (node.name === 'row') {\n      this.numRowsSeen += 1;\n      const spans = node.attributes.spans\n        ? node.attributes.spans.split(':').map(span => parseInt(span, 10))\n        : [undefined, undefined];\n      const model = (this.model = {\n        number: parseInt(node.attributes.r, 10),\n        min: spans[0],\n        max: spans[1],\n        cells: [],\n      });\n      if (node.attributes.s) {\n        model.styleId = parseInt(node.attributes.s, 10);\n      }\n      if (utils.parseBoolean(node.attributes.hidden)) {\n        model.hidden = true;\n      }\n      if (utils.parseBoolean(node.attributes.bestFit)) {\n        model.bestFit = true;\n      }\n      if (node.attributes.ht) {\n        model.height = parseFloat(node.attributes.ht);\n      }\n      if (node.attributes.outlineLevel) {\n        model.outlineLevel = parseInt(node.attributes.outlineLevel, 10);\n      }\n      if (utils.parseBoolean(node.attributes.collapsed)) {\n        model.collapsed = true;\n      }\n      return true;\n    }\n\n    this.parser = this.map[node.name];\n    if (this.parser) {\n      this.parser.parseOpen(node);\n      return true;\n    }\n    return false;\n  }\n\n  parseText(text) {\n    if (this.parser) {\n      this.parser.parseText(text);\n    }\n  }\n\n  parseClose(name) {\n    if (this.parser) {\n      if (!this.parser.parseClose(name)) {\n        this.model.cells.push(this.parser.model);\n        if (this.maxItems && this.model.cells.length > this.maxItems) {\n          throw new Error(`Max column count (${this.maxItems}) exceeded`);\n        }\n        this.parser = undefined;\n      }\n      return true;\n    }\n    return false;\n  }\n\n  reconcile(model, options) {\n    model.style = model.styleId ? options.styles.getStyleModel(model.styleId) : {};\n    if (model.styleId !== undefined) {\n      model.styleId = undefined;\n    }\n\n    const cellXform = this.map.c;\n    model.cells.forEach(cellModel => {\n      cellXform.reconcile(cellModel, options);\n    });\n  }\n}\n\nmodule.exports = RowXform;\n"],"mappings":"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"}