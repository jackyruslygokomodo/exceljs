{"version":3,"file":"parse-sax.js","names":["require","SaxesParser","PassThrough","bufferToString","module","exports","iterable","pipe","Symbol","asyncIterator","saxesParser","on","err","error","events","value","push","eventType","chunk","write"],"sources":["../../../lib/utils/parse-sax.js"],"sourcesContent":["const {SaxesParser} = require('saxes');\nconst {PassThrough} = require('readable-stream');\nconst {bufferToString} = require('./browser-buffer-decode');\n\nmodule.exports = async function* (iterable) {\n  // TODO: Remove once node v8 is deprecated\n  // Detect and upgrade old streams\n  if (iterable.pipe && !iterable[Symbol.asyncIterator]) {\n    iterable = iterable.pipe(new PassThrough());\n  }\n  const saxesParser = new SaxesParser();\n  let error;\n  saxesParser.on('error', err => {\n    error = err;\n  });\n  let events = [];\n  saxesParser.on('opentag', value => events.push({eventType: 'opentag', value}));\n  saxesParser.on('text', value => events.push({eventType: 'text', value}));\n  saxesParser.on('closetag', value => events.push({eventType: 'closetag', value}));\n  for await (const chunk of iterable) {\n    saxesParser.write(bufferToString(chunk));\n    // saxesParser.write and saxesParser.on() are synchronous,\n    // so we can only reach the below line once all events have been emitted\n    if (error) throw error;\n    // As a performance optimization, we gather all events instead of passing\n    // them one by one, which would cause each event to go through the event queue\n    yield events;\n    events = [];\n  }\n};\n"],"mappings":";;;+CACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AADA,eAAsBA,OAAO,CAAC,OAAO,CAAC;EAA/BC,WAAW,YAAXA,WAAW;AAClB,gBAAsBD,OAAO,CAAC,iBAAiB,CAAC;EAAzCE,WAAW,aAAXA,WAAW;AAClB,gBAAyBF,OAAO,CAAC,yBAAyB,CAAC;EAApDG,cAAc,aAAdA,cAAc;AAErBC,MAAM,CAACC,OAAO;EAAA,wEAAG,iBAAiBC,QAAQ;IAAA;IAAA;MAAA;QAAA;UACxC;UACA;UACA,IAAIA,QAAQ,CAACC,IAAI,IAAI,CAACD,QAAQ,CAACE,MAAM,CAACC,aAAa,CAAC,EAAE;YACpDH,QAAQ,GAAGA,QAAQ,CAACC,IAAI,CAAC,IAAIL,WAAW,EAAE,CAAC;UAC7C;UACMQ,WAAW,GAAG,IAAIT,WAAW,EAAE;UAErCS,WAAW,CAACC,EAAE,CAAC,OAAO,EAAE,UAAAC,GAAG,EAAI;YAC7BC,KAAK,GAAGD,GAAG;UACb,CAAC,CAAC;UACEE,MAAM,GAAG,EAAE;UACfJ,WAAW,CAACC,EAAE,CAAC,SAAS,EAAE,UAAAI,KAAK;YAAA,OAAID,MAAM,CAACE,IAAI,CAAC;cAACC,SAAS,EAAE,SAAS;cAAEF,KAAK,EAALA;YAAK,CAAC,CAAC;UAAA,EAAC;UAC9EL,WAAW,CAACC,EAAE,CAAC,MAAM,EAAE,UAAAI,KAAK;YAAA,OAAID,MAAM,CAACE,IAAI,CAAC;cAACC,SAAS,EAAE,MAAM;cAAEF,KAAK,EAALA;YAAK,CAAC,CAAC;UAAA,EAAC;UACxEL,WAAW,CAACC,EAAE,CAAC,UAAU,EAAE,UAAAI,KAAK;YAAA,OAAID,MAAM,CAACE,IAAI,CAAC;cAACC,SAAS,EAAE,UAAU;cAAEF,KAAK,EAALA;YAAK,CAAC,CAAC;UAAA,EAAC;UAAC;UAAA;UAAA;UAAA,2BACvDT,QAAQ;QAAA;UAAA;UAAA;QAAA;UAAA;YAAA;YAAA;UAAA;UAAjBY,KAAK;UACpBR,WAAW,CAACS,KAAK,CAAChB,cAAc,CAACe,KAAK,CAAC,CAAC;UACxC;UACA;UAAA,KACIL,KAAK;YAAA;YAAA;UAAA;UAAA,MAAQA,KAAK;QAAA;UAAA;UAGtB,OAAMC,MAAM;QAAA;UACZA,MAAM,GAAG,EAAE;QAAC;UAAA;UAAA;UAAA;QAAA;UAAA;UAAA;QAAA;UAAA;UAAA;UAAA;UAAA;QAAA;UAAA;UAAA;UAAA;YAAA;YAAA;UAAA;UAAA;UAAA;QAAA;UAAA;UAAA;YAAA;YAAA;UAAA;UAAA;QAAA;UAAA;QAAA;UAAA;QAAA;QAAA;UAAA;MAAA;IAAA;EAAA,CAEf;EAAA;IAAA;EAAA;AAAA"}