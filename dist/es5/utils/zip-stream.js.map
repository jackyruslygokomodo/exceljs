{"version":3,"file":"zip-stream.js","names":["events","require","JSZip","StreamBuf","stringToBuffer","ZipWriter","options","Object","assign","type","compression","zip","stream","data","hasOwnProperty","base64","file","name","process","browser","generateAsync","content","end","emit","size","read","encoding","setEncoding","pause","resume","isPaused","destination","pipe","unpipe","chunk","unshift","wrap","EventEmitter","module","exports"],"sources":["../../../lib/utils/zip-stream.js"],"sourcesContent":["const events = require('events');\nconst JSZip = require('jszip');\n\nconst StreamBuf = require('./stream-buf');\nconst {stringToBuffer} = require('./browser-buffer-encode');\n\n// =============================================================================\n// The ZipWriter class\n// Packs streamed data into an output zip stream\nclass ZipWriter extends events.EventEmitter {\n  constructor(options) {\n    super();\n    this.options = Object.assign(\n      {\n        type: 'nodebuffer',\n        compression: 'DEFLATE',\n      },\n      options\n    );\n\n    this.zip = new JSZip();\n    this.stream = new StreamBuf();\n  }\n\n  append(data, options) {\n    if (options.hasOwnProperty('base64') && options.base64) {\n      this.zip.file(options.name, data, {base64: true});\n    } else {\n      // https://www.npmjs.com/package/process\n      if (process.browser && typeof data === 'string') {\n        // use TextEncoder in browser\n        data = stringToBuffer(data);\n      }\n      this.zip.file(options.name, data);\n    }\n  }\n\n  async finalize() {\n    const content = await this.zip.generateAsync(this.options);\n    this.stream.end(content);\n    this.emit('finish');\n  }\n\n  // ==========================================================================\n  // Stream.Readable interface\n  read(size) {\n    return this.stream.read(size);\n  }\n\n  setEncoding(encoding) {\n    return this.stream.setEncoding(encoding);\n  }\n\n  pause() {\n    return this.stream.pause();\n  }\n\n  resume() {\n    return this.stream.resume();\n  }\n\n  isPaused() {\n    return this.stream.isPaused();\n  }\n\n  pipe(destination, options) {\n    return this.stream.pipe(destination, options);\n  }\n\n  unpipe(destination) {\n    return this.stream.unpipe(destination);\n  }\n\n  unshift(chunk) {\n    return this.stream.unshift(chunk);\n  }\n\n  wrap(stream) {\n    return this.stream.wrap(stream);\n  }\n}\n\n// =============================================================================\n\nmodule.exports = {\n  ZipWriter,\n};\n"],"mappings":"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"}